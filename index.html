<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EbookReferral dApp</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>
<body style="font-family: sans-serif; text-align:center; margin-top:50px;">

  <h2>üìö EbookReferral dApp</h2>
  <button id="connectButton">Connect Wallet</button>
  <p id="walletAddress"></p>

  <hr style="margin:20px 0;">

  <input type="text" id="referralCode" placeholder="Enter referral code (optional)" />
  <button id="buyButton">Buy eBook</button>

  <p id="status"></p>

  <script>
    const contractAddress = "0xd4d6d60400fd0c25d09859eafdf2fd6f44af6d9c";
    const abi = [/
[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"string","name":"code","type":"string"}],"name":"buyEbook","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"discountedPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"","type":"string"}],"name":"referrers","outputs":[{"internalType":"address","name":"wallet","type":"address"},{"internalType":"bool","name":"isRegistered","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string","name":"code","type":"string"}],"name":"registerCode","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"regularPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]/];

    let provider, signer, contract;

    async function connectWallet() {
      if (window.ethereum) {
        await ethereum.request({ method: "eth_requestAccounts" });
        provider = new ethers.providers.Web3Provider(window.ethereum);
        signer = provider.getSigner();
        const address = await signer.getAddress();
        document.getElementById("walletAddress").innerText = "Connected: " + address;

        contract = new ethers.Contract(contractAddress, abi, signer);
        document.getElementById("status").innerText = "Contract connected!";
      } else {
        alert("MetaMask not detected!");
      }
    }

    async function buyEBook() {
      if (!contract) return alert("Connect wallet first!");
      const referral = document.getElementById("referralCode").value || "NONE";
      const price = ethers.utils.parseEther("0.0003"); // Change based on your price

      try {
        const tx = await contract.buyEbook(referral, { value: price });
        document.getElementById("status").innerText = "Transaction sent! Waiting for confirmation...";
        await tx.wait();
        document.getElementById("status").innerText = "‚úÖ Purchase successful!";
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = "‚ùå Transaction failed.";
      }
    }

    document.getElementById("connectButton").onclick = connectWallet;
    document.getElementById("buyButton").onclick = buyEBook;
  </script>

</body>
</html>
